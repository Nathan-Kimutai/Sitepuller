(self.AMP=self.AMP||[]).push({n:"amp-auto-lightbox",v:"2005151844001",f:(function(AMP,_){
function m(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var f=b[c];if(f&&f.Math==Math)return}(function(){throw Error("Cannot find global object");})()}m(this);var n;function p(){var a,b;this.promise=new Promise(function(c,f){a=c;b=f});this.resolve=a;this.reject=b};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function q(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var r=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function t(a){return a?Array.prototype.slice.call(a):[]};var u=self.AMP_CONFIG||{},v=("string"==typeof u.cdnProxyRegex?new RegExp(u.cdnProxyRegex):u.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function w(a){if(self.document&&self.document.head&&(!self.location||!v.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}u.cdnUrl||w("runtime-host");u.geoApiUrl||w("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var x=self.__AMP_LOG;function y(){if(x.dev)return x.dev;throw Error("failed to call initLogConstructor");};var z=Object.prototype.hasOwnProperty;function A(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}
function B(a){return a.closest?a.closest("a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]"):A(a,function(a){var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;return c?c.call(a,"a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]"):!1})}
function C(a){var b=a.tagName;4>b.length||b.lastIndexOf("AMP-",0);if(a.createdCallback)return Promise.resolve(a);if(!a.__AMP_UPG_PRM){var c=new p;a.__AMP_UPG_PRM=c.promise;a.__AMP_UPG_RES=c.resolve}return a.__AMP_UPG_PRM};(function(a){return a||{}})({c:!0,v:!0,a:!0,ad:!0,action:!0});function D(a){if(a.__AMP__EXPERIMENT_TOGGLES)return a.__AMP__EXPERIMENT_TOGGLES;a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);var b=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var c in a.AMP_CONFIG){var f=a.AMP_CONFIG[c];"number"===typeof f&&0<=f&&1>=f&&(b[c]=Math.random()<f)}if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-doc-opt-in"])&&0<a.AMP_CONFIG["allow-doc-opt-in"].length){var k=a.AMP_CONFIG["allow-doc-opt-in"],g=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]');
if(g){var e=g.getAttribute("content").split(",");for(c=0;c<e.length;c++)-1!=k.indexOf(e[c])&&(b[e[c]]=!0)}}Object.assign(b,E(a));if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-url-opt-in"])&&0<a.AMP_CONFIG["allow-url-opt-in"].length){c=a.AMP_CONFIG["allow-url-opt-in"];var l=a.location.originalHash||a.location.hash;a=Object.create(null);if(l)for(var h;h=r.exec(l);){var d=q(h[1],h[1]);h=h[2]?q(h[2].replace(/\+/g," "),h[2]):"";a[d]=h}for(l=0;l<c.length;l++)d=a["e-"+c[l]],"1"==d&&(b[c[l]]=!0),"0"==
d&&(b[c[l]]=!1)}return b}function E(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(k){y().warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var c=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var f=0;f<c.length;f++)0!=c[f].length&&("-"==c[f][0]?a[c[f].substr(1)]=!1:a[c[f]]=!0);return a};var F={},G=(F["ampdoc-fie"]={isTrafficEligible:function(){return!0},branches:[["21065001"],["21065002"]]},F);function H(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return I(a,b)}function J(a,b){var c=K(a);c=L(c);return I(c,b)}function K(a){return a.nodeType?H((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function L(a){a=K(a);return a.isSingleDoc()?a.win:a}function I(a,b){M(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function M(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/nochunking=1/.test(self.location.hash);(function(){return n?n:n=Promise.resolve(void 0)})();var N={Article:!0,NewsArticle:!0,BlogPosting:!0,LiveBlogPosting:!0,DiscussionForumPosting:!0};function O(){}function P(a){return J(a,"mutator").mutateElement(a,function(){a.setAttribute("i-amphtml-auto-lightbox-visited","")})}function Q(a){return C(a).then(function(a){return a.signals().whenSignal("load-end")})}
function R(a){return t(a.getRootNode().querySelectorAll('script[type="application/ld+json"]')).map(function(a){try{var c=JSON.parse(a.textContent)}catch(f){c=null}return(c||{})["@type"]}).filter(function(a){return a})}function S(a){return R(a).some(function(a){return N[a]})}function T(a){function b(c){return!!a.getRootNode().querySelector(c)}return b('script[custom-element="amp-lightbox-gallery"]')&&b("[lightbox]:not([i-amphtml-auto-lightbox-visited])")}var U=0;
function V(a,b){return J(a,"mutator").mutateElement(b,function(){b.setAttribute("lightbox","i-amphtml-auto-lightbox-"+U++)}).then(function(){H(a.win,"extensions").installExtensionForDoc(a,"amp-lightbox-gallery");b.dispatchCustomEvent("amp-auto-lightbox:newly-set");return b})}
function W(a,b){b.map(function(c){return Q(c).then(function(){var b;if(b=!c.signals().get("unload")){var k=c.querySelector("img");b=k.naturalWidth;k=k.naturalHeight;var g=c.getLayoutBox(),e=g.width,l=g.height,h=J(c,"viewport").getSize();g=h.width;h=h.height;e*=l;if(b=1.2<=b*k/e||b>g||k>h||.25<=e/(g*h)){if(B(c))var d=!1;else{b=c.ownerDocument.defaultView;e=b.__AMP_TOP||(b.__AMP_TOP=b);k=b!=e;if(D(e)["ampdoc-fie"]){e.__AMP_EXPERIMENT_BRANCHES=e.__AMP_EXPERIMENT_BRANCHES||{};for(d in G)if(z.call(G,d)&&
!z.call(e.__AMP_EXPERIMENT_BRANCHES,d))if(G[d].isTrafficEligible&&G[d].isTrafficEligible(e)){if(g=!e.__AMP_EXPERIMENT_BRANCHES[d])g=d,g=!!D(e)[g];g&&(g=G[d].branches,e.__AMP_EXPERIMENT_BRANCHES[d]=g[Math.floor(Math.random()*g.length)]||null)}else e.__AMP_EXPERIMENT_BRANCHES[d]=null;d="21065002"===(e.__AMP_EXPERIMENT_BRANCHES?e.__AMP_EXPERIMENT_BRANCHES["ampdoc-fie"]:null)}else d=!1;k&&!d?d=M(b,"action")?I(b,"action"):null:(d=K(c),d=L(d),d=M(d,"action")?I(d,"action"):null);d=!d.hasResolvableAction(c,
"tap")}b=d}}if(b)return y().info("amp-auto-lightbox","apply",c),V(a,c)},O)})}function X(a,b){if(T(a))var c=0;else c=(c=a.getRootNode().querySelector('meta[property="og:type"]'))?c.getAttribute("content"):void 0,c="article"==c||S(a);c?(c=t((b||a.win.document).querySelectorAll("amp-img:not([lightbox]):not([i-amphtml-auto-lightbox-visited])")),c.forEach(P),W(a,c)):y().info("amp-auto-lightbox","disabled")}
(function(a){var b=a.ampdoc;b.whenReady().then(function(){b.getRootNode().addEventListener("amp:dom-update",function(a){X(b,a.target)});X(b)})})(self.AMP);
})});

//# sourceMappingURL=amp-auto-lightbox-0.1.js.map
